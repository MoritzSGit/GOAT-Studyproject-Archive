with y as (
	select grid_id, jsonb_build_object(amenity, sum(exp(cost::numeric*-%f))) index_part from(

		EXPLAIN ANALYZE
		SELECT u.grid_id, obj.value->>'amenity' as amenity,obj.value->>'name',obj.value->>'cost' As cost
		FROM  (
		   select grid_id,pois
		   FROM   grid_500
		   WHERE  pois @> '[{"amenity":"supermarket"}]'
		   ) u
		JOIN LATERAL jsonb_array_elements(pois) obj(value) 
		ON obj.value->>'amenity' = 'supermarket'
		order by grid_id
		
		
		) x
	group by grid_id, amenity
)
UPDATE grid_%i 
SET index_0_%s = index_0_%s||y.index_part
from y
where grid_%i.grid_id = y.grid_id;

CREATE INDEX ON grid_500 USING GIN (pois);